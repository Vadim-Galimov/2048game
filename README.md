# 2048 game

<!-- PROJECT LOGO -->
<br />
<div align="center">
  <a href="https://vadim-galimov.github.io/2048game/dist/">
    <img src="readme-logo.jpg" alt="Logo" width="80" height="80">
  </a>
  
 <p  align="center"> &#8657; попробовать &#8657; </p>

</div>

<!-- ABOUT THE PROJECT -->

## Правила игры:

### Старт уровня:

• игрок запускается сразу на пустом уровне, где есть 2 плитки с
цифрой «2». Счёт изначально равен 0.

### Определение хода:

• Игрок может пролистнуть (нажать, сдвинуть курсор/палец,
отпустить) в одну из сторон: влево, вправо, вверх, вниз. Должно
быть минимальное расстояние, на которое игрок должен
сдвинуть курсор, чтобы это посчиталось за ход. Если игрок
сдвигает курсор/палец по диагонали, но ход делается
относительно той оси, по которой он сделал большее движение.
Например, если игрок сдвинул курсор на 200px вверх и 180px
вправо, то совершается ход вверх. Также доступно управление клавиатурой.

### Какие плитки можно соединить?

• Плитки можно соединить, если они имеют одинаковое значение
и находятся рядом (имеют 1 общее ребро).
После хода игрока:

• Все плитки сдвигаются в требуемом направлении

• Если 2 плитки находятся рядом и сдвигаются «друг к
другу», то они соединяются в 1 плитку со значением, в 2
раза больше. Значения старых плиток прибавляются в
счёт.

• После хода на поле в случайном месте появляется новая плитка.

### Новый ход:

С вероятностью 90% это плитка со значением «2», с
вероятностью 10% - со значением «4».

### Условия победы и проигрыша:

• Если после хода на поле появляется плитка со значением
«2048», то появляется надпись с текстом "YOU WIN!".
После нажатия «Try again» игра начинается заново.
• Если после хода и добавления новой плитки возникает ситуация,
что не существует плиток, которые можно соединить,
появляется надпись с текстом "GAME OVER!". После
нажатия «Try again» игра начинается заново.
:

## Механика игры:

### Запуск приложения ( app.run() )

-Устанавливаю контроллер

-Запускаю новую игру

### Старт игры ( app.startNewGame() )

-Сброс данных (все данные приводятся к значению начала игры)

-Создаю две ячейки

-Рисую счёт

-Включаю отрисовку тела

-Ставлю на таймер очистку ячеек (когда в конце хода, новосозданные ячейки или после слияния теряют таковой статус и начинают считаться обычными)

### Ход:

#### До вызова хода ( app.rebind.doMove() ):

-Проверка на блок хода

-Ставлю блок хода

-Ставлю направление

-Запускаю ход

#### Фаза 1:

-Запускаю отрисовку

-Раздаю билеты ячейкам

-Двигаю ячейки

-Задержка (чтобы анимации закончились)

#### Фаза 2:

-Меняю счёт

-Удаляю лишние ячейки

-Включаю проверки хода:

а) проверка на победу

б) проверка на поражение

в) было ли движение (если да - ход считается состоявшимся и создаётся новая ячейка)

-Включаю отрисовку тела

-Задержка

#### После хода:

-Сброс статусов ячеек

-Если ни луз, ни победа, то снимается блок хода

### Победа:

#### Условие:

Проверяю значения всех ячеек, если хоть одна равна 2048 - победа

#### Действия:

Поле накрывает полупрозрачный золотой фон

Появляется надпись "YOU WIN!"

Появляется кнопка "Try again", которая перезапустит игру

## Связи файлов:

index.html > index.js

index.js > App.js

App. js > {Drawer.js, Controller.js, Field.js }

## Модули

App.js - Логика основной части приложения

Controller.js - отслеживает действия пользователя

Field.js - хранит массив ячеек и прочую информацию

Drawer.js - занимается отрисовкой

### Controller.js

Реагирует на события:
'keydown'
'mousedown'
'mouseup'
'mousemove'
'touchstart'
'touchmove'
'touchend'

А 'click' - вне канваса, на кнопки админ панели

Создаёт 4 типа взаимодействия, а также на 5 кнопок админки

Основа:

1. ход

Мышкой, клавиатурой или тачпадом было совершенно действие, удовлетворяющее условиям совершения хода.

2. Перемещение мыши
   Считываются и записываются координаты мыши, что позволяет взаимодействовать с кликабельными объектами канваса, в том числе и без нажатия (изменение курсора)

3. Клик

Мышкой или тачпадом

4. Нажатие тачпада

Отличается от клика мышкой еще тем, что в данном случается передаются координаты нажатия

Кнопки:

makeLose - сделать проигрыш

makeWin - сделать победу
makePrewinSituation - сделать ситуацию в 1 ход до победы

makePreloseSituation - сделать ситуацию в 1 ход до поражения

startNewGame - новая игра

### Drawer.js

Есть 3 элемента отрисовки:

Drawer.#drawBackground() - рисует фон

Drawer.drawButton() - рисует кнопки Try again

Drawer.drawWin() - накладывает прозрачный вон и надпись "YOU WIN"

Drawer.drawLose() - накладывает прозрачный фон и надпись "GAME OVER"

Drawer.drawCells() - рисует клетки с номерами

Drawer.drawScore() - рисует счёт

Drawer.runBodyDrawer() - многократно вызывает метод Drawer.drawCells() за счёт чего мы видим анимацию

### Field.js

содержит следующие данные:

moveDeltaXY - изменение координат при движение

score - счёт

cellArray - массив ячеек

moveDirection - направление движения во время хода

phaseTime - время одной фазы (половина хода)

winStatus - статус победы

loseStatus - статус проигрыша

moveDetected - было ли замечено движение во время хода (1 если да, от этого зависет, будет ли засчитан ход)

columnArray - многомерный массив, для упрощения расчёта конечного номера, которая примет ячейка в конце движения

turnBlock - блокатор хода (не даёт сделать ход, пока не закончен предидущий)

2 метода:

getCellFromNumber(number) - возвращает объект ячейки с соотвествующим номером (поиск происходит из уже существующих ячеек)

createCell - создаёт новую ячейку

А также объект кнопки:

buttonTryAgain - Кнопка "Try again" содержит координаты, чтобы можно было расчитать, когда курсор над кнопкой и засчитать нажатие по ней

### App.js

Имееет 3 основных метода и множество дополнительных:

1. run()

Запускает приложение в первый раз, а именно подключает контроллер и запускает новую игру

2)startNewGame()

Начинает новую игру, а именно: все изменные за игру данные приводит к первоначальному виду, создаёт две ячейки, включает вычисление динамических размеров ячеек (при появлении, или слиянии - размеры какое-то время меняются), а также динамически рисует тело и счёт

3. makeTurn()

совершает ход

## Тесты:

04.07.23 19:00

1. загрузка прошла

2. стрелки работают

3. пароль админа работает

4. все кнопки админки срабатывают

5. управление мышкой работает

6. интер работает

7. быстро нажатие - без проблем

8. зажатие стрелок - без проблем

9. ломаные нажатия мышки на кнопки - не срабатывают

10. проиграть на пк - без проблем

11. выиграть на пк - без проблем

12. тачпад работает

13. проиграть на телефоне - без проблем

14. выиграть на телефоне - без проблем

## Тайминги:

    Пошёл ход:

    0s

    запусается интервальный  drawCells() в течении 2 phaseTime

    запусакется timerMakeStep() - ячейки начинают двигаться в течении 1 phaseTime

    1 phaseTime

    Заканчивается timerMakeStep()

    Смена данных ячеек

    выбор действия, которое сработает через 1 phaseTime:

    {

    	Если луз или вин, через 1 phaseTime сработает  одно из этих событий

    	Если оба не сработали - через 1 phaseTime снимается блок хода

    }

    2 phaseTime

    Срабатывает одно из событий в скобках

    Заканчивается прорисовка

## Дополнительно:

Введите с клавиатуры "admin" для доступа к панели администратора.
