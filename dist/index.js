(()=>{"use strict";class e{static init(){e.#e(),e.#t(),e.#a(),e.#n()}static#e(){let t=new Array;document.addEventListener("keydown",(function(a){switch(a.code){case"ArrowUp":e.doMove("up");break;case"ArrowDown":e.doMove("down");break;case"ArrowLeft":e.doMove("left");break;case"ArrowRight":e.doMove("right");break;case"Enter":a.preventDefault(),e.pressEnter()}t.push(a.code),t.length>5&&t.shift(),t.join()==["KeyA","KeyD","KeyM","KeyI","KeyN"].join()&&e.openAdminPanel()}))}static#t(){let t,a,n,i;function r(r){return null===event||"touchstart"==event.type?0:(a=r.x,i=r.y,function(){let r,s=[a-t,i-n];if(Math.abs(s[0])+Math.abs(s[1])<200)return 0;Math.abs(s[0])>Math.abs(s[1])?e.axis="x":e.axis="y","y"==e.axis&&(r=s[1]>0?"down":"up"),"x"==e.axis&&(r=s[0]>0?"right":"left"),e.doMove(r)}(),void(Math.abs(a-t)+Math.abs(i-n)<5&&e.buttonClick()))}document.addEventListener("mousedown",(function(e){return null===event||"touchstart"==event.type?0:(t=e.x,n=e.y,void document.addEventListener("mouseup",r))})),document.addEventListener("mousemove",e.checkMouseMove)}static#a(){let t,a;function n(t,a,n){let i=t.x,r=t.y;Math.abs(a-i)+Math.abs(n-r)<5&&e.touchButtonClick(a,n)}document.addEventListener("touchstart",(function(n){document.addEventListener("touchmove",(function(e){n&&(t=e.touches[0].pageX-n.touches[0].pageX,a=e.touches[0].pageY-n.touches[0].pageY)}),event),document.addEventListener("touchend",(function(){return isNaN(Math.abs(t))||Math.abs(t)+Math.abs(a)<100?0:(Math.abs(t)>Math.abs(a)?e.axis="x":e.axis="y","y"==e.axis&&(moveTo=a>0?"down":"up"),"x"==e.axis&&(moveTo=t>0?"right":"left"),e.doMove(moveTo),void(n=null))}))}),event),document.addEventListener("touchstart",(function(){elem=document.getElementById("canvasBody");let e=event.touches[0]?.pageX,t=event.touches[0]?.pageY;document.addEventListener("touchend",n,event,e,t)}))}static#n(){document.getElementById("startNewGame").addEventListener("click",e.triggerButton),document.getElementById("makeLose").addEventListener("click",e.triggerButton),document.getElementById("makeWin").addEventListener("click",e.triggerButton),document.getElementById("makePrewinSituation").addEventListener("click",e.triggerButton),document.getElementById("makePreloseSituation").addEventListener("click",e.triggerButton)}static triggerButton;static doMove;static makeLose;static makeWin;static makePrewinSituation;static makePreloseSituation;static startNewGame;static checkMouseMove;static buttonClick;static touchButtonClick;static pressEnter;static openAdminPanel}class t{static#i=80;static#r=t.#i/8;static#s=4*t.#i+5*t.#r;static#o=t.#r+t.#i;static#l=t.#i/8*3;static drawScore(e){let a=document.getElementById("canvasHead").getContext("2d");a.clearRect(0,0,canvasHead.width,canvasHead.height),a.font="bold "+35*t.#i/80+"px sans-serif";let[n,i]=t.#c("SCORE:"+e,a);a.fillStyle="#bbada0";let r=n+t.#l,s=25*t.#i/80,o=t.#i/4,l=t.#i/8;t.#u(a,(t.#s-r)/2-s,o,n+(t.#s-r)/2+s,o+i+2*l,20),a.strokeStyle="#776e65",t.#d(a,(t.#s-r)/2-s,o,n+(t.#s-r)/2+s,o+i+2*l,20,5),a.fillStyle="#ebe4da",a.fillText("SCORE: "+e,(t.#s-r)/2,o+i+l)}static runBodyDrawer(e,a){let n=setInterval(t.drawCells,10,a);setTimeout(clearInterval,e,n)}static drawCells(e){let a=document.getElementById("canvasBody").getContext("2d");a.clearRect(0,0,canvasBody.width,canvasBody.height),t.#m(),e.forEach((function(e){let n=e.valueOfDraw;switch(n){case 2:case 4:case 8:case 16:case 32:case 64:a.font="bold 50px sans-serif";break;case 128:case 256:case 512:a.font="bold 42px sans-serif";break;case 1024:case 2048:a.font="bold 35px sans-serif"}switch(n){case 2:a.fillStyle="#eee4da";break;case 4:a.fillStyle="#ede0c8";break;case 8:default:a.fillStyle="#f2b179";break;case 16:a.fillStyle="#f59563";break;case 32:a.fillStyle="#f67c5f";break;case 64:a.fillStyle="#f35c3d";break;case 128:a.fillStyle="#e7cf73";break;case 256:a.fillStyle="#ecca64";break;case 512:case 1024:a.fillStyle="#eac75c";break;case 2048:a.fillStyle="#e6bd4f"}switch(t.#u(a,e.x+e.sizePenalty-e.sizeBonus,e.y+e.sizePenalty-e.sizeBonus,e.x+t.#i-e.sizePenalty+e.sizeBonus,e.y+t.#i-e.sizePenalty+e.sizeBonus,3),n){case 2:case 4:default:a.fillStyle="#776e65";break;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:a.fillStyle="#f9f6f2"}let[i,r]=t.#c(n,a),s=(t.#i-i)/2,o=(t.#i-r)/2;a.fillText(n,e.x+s,e.y+o+r)}))}static drawLose(){let e=document.getElementById("canvasBody").getContext("2d");e.fillStyle="rgba(255, 255, 255, 0.5)",t.#u(e,0,0,t.#s,t.#s,10),e.fillStyle="#776e65",e.font="bold 50px sans-serif";let[a,n]=t.#c("GAME OVER!",e),i=(t.#s-a)/2,r=(t.#s-n)/2;e.fillText("GAME OVER!",i,r+n)}static drawWin(){let e=document.getElementById("canvasBody").getContext("2d");e.fillStyle="rgba(255, 215, 0, 0.5)",t.#u(e,0,0,t.#s,t.#s,10),e.fillStyle="#f9f6f2",e.font="bold 50px sans-serif";let[a,n]=t.#c("YOU WIN!",e),i=(t.#s-a)/2,r=(t.#s-n)/2;e.fillText("YOU WIN!",i,r+n)}static#m(){let e=document.getElementById("canvasBody").getContext("2d");e.fillStyle="#776e65",t.#u(e,0,0,t.#s,t.#s,10),e.fillStyle="#bbada0";for(let a=0;a<4;a++)for(let n=0;n<4;n++){let i=t.#r+t.#o*n,r=t.#r+t.#o*a;t.#u(e,i,r,i+t.#i,r+t.#i,3)}}static drawButton(e){let a=document.getElementById("canvasBody").getContext("2d");a.fillStyle="#8f7a66",a.font="bold "+t.#i/4+"px sans-serif";let[n,i]=t.#c("Try again",a),r=n+t.#l;return t.#u(a,(t.#s-r)/2,220,n+30+(t.#s-r)/2,i+15+220,3),a.fillStyle="#f9f6f2",a.fillText("Try again",(t.#s-n-10)/2+2,244),[(t.#s-r)/2,220,n+30+(t.#s-r)/2,i+15+220]}static#u(e,t,a,n,i,r){r=Math.min(r,(n-t)/2,(i-a)/2),e.beginPath(),e.moveTo(t+r,a),e.lineTo(n-r,a),e.arcTo(n,a,n,a+r,r),e.lineTo(n,i-r),e.arcTo(n,i,n-r,i,r),e.lineTo(t+r,i),e.arcTo(t,i,t,i-r,r),e.lineTo(t,a+r),e.arcTo(t,a,t+r,a,r),e.fill()}static#d(e,t,a,n,i,r,s){e.lineWidth=s,r=Math.min(r,(n-t)/2,(i-a)/2),e.beginPath(),e.moveTo(t+r,a),e.lineTo(n-r,a),e.arcTo(n,a,n,a+r,r),e.lineTo(n,i-r),e.arcTo(n,i,n-r,i,r),e.lineTo(t+r,i),e.arcTo(t,i,t,i-r,r),e.lineTo(t,a+r),e.arcTo(t,a,t+r,a,r),e.stroke()}static#c(e,t){let a=t.measureText(e),n=a.actualBoundingBoxAscent+a.actualBoundingBoxDescent;return[a.width,n]}}class a{constructor(e){this.random10Percent=Math.floor(10*Math.random()),this.value=2,9==this.random10Percent&&(this.value=4),this.number=e+1,this.ticket=this._number,this.toDelete=0,this.statusNewlyCreating=1,this.sizePenalty=0,this.statusEndedMerge=0,this.sizeBonus=0}set number(e){this._number=e,this.index=this._number-1,this.columnNumber=(this.index+1)%4!=0?(this.index+1)%4:4,this.rowNumber=Math.floor(this.index/4)+1,this.x=90*this.columnNumber-80,this.y=90*this.rowNumber-80,this.moveSpeed=0,this.mergeBlock=0,this.valueOfDraw=this.value}get number(){return this._number}animateMerge(e){if(0==this.statusEndedMerge)return 0;this.sizeBonus=1*e}animateCreating(e){if(0==this.statusNewlyCreating)return 0;this.sizePenalty=2*e}stopAnimating(){this.statusNewlyCreating=0,this.sizePenalty=0,this.statusEndedMerge=0,this.sizeBonus=0}}new a;class n{static buttonTryAgain={cursorOverbutton:0,set buttonXY(e){[this.buttonX1,this.buttonY1,this.buttonX2,this.buttonY2]=e}};static moveDeltaXY={down:[0,90],up:[0,-90],left:[-90,0],right:[90,0]};static score=0;static cellArray=[];static moveDirection;static phaseTime=100;static winStatus=0;static loseStatus=0;static moveDetected=0;static columnArray={down:[[13,9,5,1],[14,10,6,2],[15,11,7,3],[16,12,8,4]],up:[[1,5,9,13],[2,6,10,14],[3,7,11,15],[4,8,12,16]],left:[[1,2,3,4],[5,6,7,8],[9,10,11,12],[13,14,15,16]],right:[[4,3,2,1],[8,7,6,5],[12,11,10,9],[16,15,14,13]]};static turnBlock=0;static getCellFromNumber(e){return n.cellArray.find((function(t,a){return t.ticket==e}))}static resetData(){n.winStatus=0,n.loseStatus=0,n.score=0,n.buttonTryAgain.visible=0,n.buttonTryAgain.cursorOverbutton=0,document.body.style.cursor="default",n.cellArray=[],n.turnBlock=0}static make2ActiveCells(){let e,t=Math.floor(16*Math.random());do{e=Math.floor(16*Math.random())}while(e===t);let i=new a(t);n.cellArray.push(i),i=new a(e),n.cellArray.push(i),n.cellArray.forEach((function(e){e.value=2,e.valueOfDraw=2}))}static make1ActiveCell(){let e;do{e=Math.floor(16*Math.random())}while(n.cellArray.find((function(t){return t.ticket==e+1})));let t=new a(e);n.cellArray.push(t)}static deleteExcessCells(){n.cellArray=n.cellArray.filter((function(e){return 1!=e.toDelete}))}}new e,new t,new n;class i{static run(){i.#h(),i.startNewGame()}static startNewGame(){n.resetData(),n.make2ActiveCells(),i.#f(),t.drawScore(n.score),t.runBodyDrawer(2*n.phaseTime,n.cellArray)}static async makeTurn(){await i.turn.runPhaseOne(),await i.turn.runPhaseTwo(),await i.turn.runPostTurnPhase()}static turn={async runPhaseOne(){t.runBodyDrawer(n.phaseTime,n.cellArray),i.turn.setTickets(),i.turn.allMove(),await i.turn.delay()},async runPhaseTwo(){i.#f(),i.turn.changeScore(),n.deleteExcessCells(),i.turn.checkTurnResult(),t.runBodyDrawer(n.phaseTime,n.cellArray),await i.turn.delay()},async runPostTurnPhase(){0==n.winStatus&&0==n.loseStatus&&(n.turnBlock=0)},delay:()=>new Promise((e=>setTimeout(e,n.phaseTime))),checkTurnResult:()=>(1==n.moveDetected&&n.make1ActiveCell(),n.moveDetected=0,i.gameStatus.checkWin(),1==n.winStatus?0:(i.gameStatus.checkLose(),1==n.loseStatus?0:void 0)),setTickets(){for(let t=0;t<4;t++)e(1,t),e(2,t),e(3,t);function e(e,t){let a=n.columnArray[n.moveDirection],i=n.getCellFromNumber(a[t][e]);if(!i)return 0;let r=function(e,t){return n.columnArray[n.moveDirection][e].indexOf(t.number)}(t,i),s=e-1,o=e-2,l=e-3,c=n.getCellFromNumber(a[t][s]),u=n.getCellFromNumber(a[t][o]),d=n.getCellFromNumber(a[t][l]),m=i.number,h=0;function f(e,t){return e?.value==t.value&&0==e?.mergeBlock&&0==t.mergeBlock?1:0}f(c,i)&&(h=1,m=a[t][s],i.toDelete=1,c.value*=2,c.statusEndedMerge=1,c.mergeBlock=1,i.mergeBlock=1,n.moveDetected=1),!c&&r>0&&(h=1,m=a[t][s],n.moveDetected=1,f(u,i)&&(h=2,u.value*=2,u.statusEndedMerge=1,i.toDelete=1,m=a[t][o],u.mergeBlock=1,i.mergeBlock=1),!u&&r>1&&(h=2,m=a[t][o],f(d,i)&&(h=3,m=a[t][l],d.value*=2,d.statusEndedMerge=1,i.toDelete=1,d.mergeBlock=1,i.mergeBlock=1),!d&&r>2&&(h=3,m=a[t][l]))),i.ticket=m,i.moveSpeed=h}},allMove(){let e=0,t=setInterval((()=>{e>4&&(clearInterval(t),n.cellArray.forEach((function(e){e.number=e.ticket}))),n.cellArray.forEach((function(e){e.x+=n.moveDeltaXY[n.moveDirection][0]*e.moveSpeed/(n.phaseTime/20),e.y+=n.moveDeltaXY[n.moveDirection][1]*e.moveSpeed/(n.phaseTime/20)})),e++}),n.phaseTime/5)},changeScore(){let e=0;n.cellArray.forEach((function(t){1==t.toDelete&&(e+=t.valueOfDraw)})),n.score+=2*e,t.drawScore(n.score)}};static#f(){let e=0,t=setInterval((()=>{n.cellArray.forEach((function(t){t.animateCreating(5-e),t.animateMerge(5-e)})),e++,e>4&&(clearInterval(t),n.cellArray.forEach((function(e){e.stopAnimating()})))}),10)}static adminComands={makePrewinSituation(){n.cellArray[0].value=1024,n.cellArray[1].value=1024,n.cellArray[1].valueOfDraw=1024,n.cellArray[0].valueOfDraw=1024,t.drawCells(n.cellArray)},makePreloseSituation(){i.startNewGame();for(let e=0;e<13;e++)n.make1ActiveCell();for(let e=0;e<15;e++)n.cellArray[e].value=e+32,n.cellArray[e].valueOfDraw=e+32;t.drawCells(n.cellArray)}};static#h(){e.doMove=i.rebind.doMove.bind(this),e.checkMouseMove=i.rebind.checkMouseMove.bind(this),e.buttonClick=i.rebind.buttonClick.bind(this),e.touchButtonClick=i.rebind.touchButtonClick.bind(this),e.pressEnter=i.rebind.pressEnter.bind(this),e.openAdminPanel=i.rebind.openAdminPanel.bind(this),e.triggerButton=i.rebind.triggerButton.bind(this),e.init()}static gameStatus={checkWin(){n.cellArray.map((function(e){return e.value})).includes(2048)&&(n.winStatus=1),1==n.winStatus&&setTimeout(i.gameStatus.makeWin,2*n.phaseTime)},checkLose(){if(n.loseStatus=1,n.cellArray.length<16)return n.loseStatus=0,0;for(let e=0;e<4;e++)for(let t=0;t<3;t++)n.getCellFromNumber(n.columnArray.down[e][t])?.value==n.getCellFromNumber(n.columnArray.down[e][t+1])?.value&&(n.loseStatus=0);for(let e=0;e<4;e++)for(let t=0;t<3;t++)n.getCellFromNumber(n.columnArray.right[e][t])?.value==n.getCellFromNumber(n.columnArray.right[e][t+1])?.value&&(n.loseStatus=0);1==n.loseStatus&&setTimeout(i.gameStatus.makeLose,2*n.phaseTime)},makeLose(){t.drawLose();let e=t.drawButton(n.buttonTryAgain);n.buttonTryAgain.buttonXY=e,n.buttonTryAgain.visible=1},makeWin(){t.drawWin();let e=t.drawButton(n.buttonTryAgain);n.buttonTryAgain.buttonXY=e,n.buttonTryAgain.visible=1}};static rebind={doMove(e){if(1==n.turnBlock)return 0;n.turnBlock=1,n.moveDirection=e,i.makeTurn()},checkMouseMove(e){if(1==n.buttonTryAgain.visible){let t=document.getElementById("canvasBody");e.x>n.buttonTryAgain.buttonX1+t.offsetLeft&&e.x<n.buttonTryAgain.buttonX2+t.offsetLeft&&e.y>n.buttonTryAgain.buttonY1+t.offsetTop&&e.y<n.buttonTryAgain.buttonY2+t.offsetTop?(document.body.style.cursor="pointer",n.buttonTryAgain.cursorOverbutton=1):(document.body.style.cursor="default",n.buttonTryAgain.cursorOverbutton=0)}},buttonClick(){1==n.buttonTryAgain.cursorOverbutton&&1==n.buttonTryAgain.visible&&i.startNewGame()},touchButtonClick(e,t){elem=document.getElementById("canvasBody"),e>n.buttonTryAgain.buttonX1+elem.offsetLeft&&e<n.buttonTryAgain.buttonX2+elem.offsetLeft&&t>n.buttonTryAgain.buttonY1+elem.offsetTop&&t<n.buttonTryAgain.buttonY2+elem.offsetTop&&1==n.buttonTryAgain.visible&&i.startNewGame()},pressEnter(){1!=winStatus&&1!=loseStatus||i.startNewGame()},openAdminPanel(){document.getElementById("adminPanel").style="display: block"},triggerButton(e){switch(e.target.id){case"startNewGame":i.startNewGame();break;case"makeLose":i.gameStatus.makeLose();break;case"makeWin":i.gameStatus.makeWin();break;case"makePrewinSituation":i.adminComands.makePrewinSituation();break;case"makePreloseSituation":i.adminComands.makePreloseSituation()}}}}new i,i.run()})();